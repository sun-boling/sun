# httpRunner 测试框架

## 安装

通过`pip` 命令安装：

```
> pip install httprunner
```

查看版本:

```
> hrun -V
```

##  har2case 工具

通过`fildder` 工具抓取接口，选中要导出的接口，菜单栏 `file` -> `export Sessions` -> `Selected Session...` ，在弹出的窗口选择`HttpArchive v1.2` 点击`Next` 按钮，最后给 导出的文件命名为 `case.har`。

生成JSON格式的用例：

```shell
> har2case -2j case.har
```

生成YAML格式的用例：

```shell
> har2case -2y case.har
```

以 JSON 为例，简化之后的用例如下：

```json
{
    "config": {
        "name": "testcase description",
        "variables": {},
        "verify": false
    },
    "teststeps": [
        {
            "name": "/api/v1/hello/",
            "request": {
                "url": "http://127.0.0.1:8000/api/v1/hello/",
                "method": "GET"
            },
            "validate": [
                {"eq": ["body.code", 10200]},
                {"eq": ["body.message", "success"]}
            ]
        }
    ]
}
```

## 测试用例

以 `test_case_more.json` 文件为例，编写一个接口的用例。

```json
{
     
    "config": {
        "name": "basic test config(测试接口的依赖)",
        "base_url": "http://127.0.0.1:8000/api/v1",
        "variables": {
            "user": "${username()}",
            "pawd": "${password()}"
        },
        "export": [
            "token"
        ],
        "validate": [
            {"eq": ["status_code", 200]}
        ]
    },

    "teststeps": [
        { 
            "name": " test_login",
            "request": {
                "url": "/login/",
                "method": "POST",
                "data":{"username": "$user", "password": "$pawd"}
            },
            "extract": {
                "token": "body.data.token"
            },
            "validate": [
                {"eq": ["body.code", 10200]},
                {"eq": ["body.message", "登录成功"]}
            ]
            
        },
        {
            "name": " test_luck_draw",
            "request": {
                "url": "/luck_draw/",
                "method": "POST",
                "data":{"token": "$token" }
            },
            "validate": [
                {"eq": ["body.code", 10200]}
            ]
        }
        
    ]   
}
```

用到了python 函数定义`debugtalk.py`。

```py
import time
from httprunner import __version__


def get_httprunner_version():
    return __version__


def username():
    return "admin"

def password():
    return "a123"
```

运行测试用例：

```
> hrun test_case_more.py
```

## 生成对应的链式脚本

当你运行完测试用例，生成对应的链式脚本：

```py
# NOTE: Generated By HttpRunner v3.1.4
# FROM: .\test_case_more.json


from httprunner import HttpRunner, Config, Step, RunRequest, RunTestCase


class TestCaseTestCaseMore(HttpRunner):

    config = (
        Config("basic test config(测试接口的依赖)")
        .variables(**{"user": "${username()}", "pawd": "${password()}"})
        .base_url("http://127.0.0.1:8000/api/v1")
        .export(*["token"])
    )

    teststeps = [
        Step(
            RunRequest(" test_login")
            .post("/login/")
            .with_data({"username": "$user", "password": "$pawd"})
            .extract()
            .with_jmespath("body.data.token", "token")
            .validate()
            .assert_equal("body.code", 10200)
            .assert_equal("body.message", "登录成功")
        ),
        Step(
            RunRequest(" test_luck_draw")
            .post("/luck_draw/")
            .with_data({"token": "$token"})
            .validate()
            .assert_equal("body.code", 10200)
        ),
    ]


if __name__ == "__main__":
    TestCaseTestCaseMore().test_start()

```

